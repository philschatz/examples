{"version":3,"file":null,"sources":["../../math-editor/MathBlock.js","../../math-editor/MathJaxRenderComponent.js","../../math-editor/MathQuillComponent.js","../../math-editor/AceComponent.js","../../math-editor/app.js"],"sourcesContent":["import { BlockNode } from 'substance'\n\n/*\n  Node definition\n*/\nclass MathBlock extends BlockNode {}\n\nMathBlock.define({\n  type: 'math',\n  language: 'text/tex',\n  source: 'text'\n})\n\n\nexport default MathBlock\n","import {Component} from 'substance'\n\nif (!window.MathJax) {\n  throw new Error('BUG: MathJax has not been loaded yet')\n}\n\nexport default class MathJaxRenderComponent extends Component {\n  render($$) {\n    let {node, language, source} = this.props\n\n    let el = $$('div').addClass('sc-math-render')\n    .append('Rendering ' + source)\n    .ref('renderedMathNode')\n    return el\n  }\n\n  // don't rerender because this would destroy MathJax\n  shouldRerender(newProps, newState) {\n    return this._isRenderNeeded(this.props, newProps)\n  }\n\n  _isRenderNeeded(oldProps, newProps) {\n    const {language, source} = oldProps\n    return language !== newProps.language || source.trim() !== newProps.source.trim()\n  }\n\n  didUpdate(oldProps, oldState) {\n    if (this._isRenderNeeded(oldProps, this.props)) {\n      this._renderMathJax()\n    }\n  }\n  didMount() {\n    this._renderMathJax()\n    // let editor = ace.edit(this.refs.source.getNativeElement())\n    // // editor.setTheme(\"ace/theme/monokai\");\n    // editor.setOptions({\n    //   maxLines: Infinity,\n    // });\n    // editor.$blockScrolling = Infinity;\n    // editor.getSession().setMode(\"ace/mode/\" + node.language)\n    // // TODO: don't we need to dispose the editor?\n    // // For now we update the model only on blur\n    // // Option 1: updating on blur\n    // //   pro: one change for the whole code editing session\n    // //   con: very implicit, very late, hard to get selection right\n    // editor.on('blur', this._updateModelOnBlur.bind(this))\n    //\n    // editor.commands.addCommand({\n    //   name: 'escape',\n    //   bindKey: {win: 'Escape', mac: 'Escape'},\n    //   exec: function(editor) {\n    //     this.send('escape')\n    //     editor.blur()\n    //   }.bind(this),\n    //   readOnly: true // false if this command should not apply in readOnly mode\n    // });\n    //\n    // this.editor = editor\n    // editorSession.onRender('document', this._onModelChange, this, {\n    //   path: [node.id, 'source']\n    // })\n  }\n\n  _renderMathJax() {\n    let {node, language, source} = this.props\n    let nativeMathContainer = this.refs['renderedMathNode'].getNativeElement()\n\n    // HACK? so shouldRender is called\n    // this.el = this.refs['renderedMathNode']\n\n    // Mark node up so MathJax understands\n    if (language === 'text/tex') {\n      nativeMathContainer.innerHTML = '$$' + source + '$$'\n    } else {\n      throw new Error('BUG: No math language set!')\n    }\n\n    function cb() {\n      console.log('MathJaxDoneRendering')\n    }\n    MathJax.Hub.Queue([\"Typeset\", MathJax.Hub, nativeMathContainer, cb])\n  }\n}\n","import {Component} from 'substance'\n\nif (!window.MathQuill) {\n  throw new Error('BUG: MathQuill has not been loaded yet')\n}\n\nexport default class MathQuillComponent extends Component {\n  render($$) {\n    let {node, language, source} = this.props\n\n    let el = $$('span').addClass('sc-mathquill-input').append(source)\n    .ref('mathQuillInput')\n    return el\n  }\n\n  // don't rerender because this would destroy MathJax\n  shouldRerender() {\n    return false;\n  }\n\n  _updateLatex() {\n    this.send('mathQuillUpdated', this._mathField.latex())\n  }\n\n  didMount() {\n    let {node, language, source} = this.props\n    let mathQuillInput = this.refs['mathQuillInput'].getNativeElement()\n\n    let MQ = MathQuill.getInterface(2) // for backcompat\n    this._mathField = MQ.MathField(mathQuillInput, {\n      spaceBehavesLikeTab: true, // configurable\n      handlers: {\n        edit: this._updateLatex.bind(this)\n      }\n    })\n  }\n\n}\n","import {Component} from 'substance'\n\nexport default class AceEditor extends Component {\n  render($$) {\n    let {source} = this.props\n    let el = $$('div').addClass('sc-ace-editor')\n    el.append(\n      $$('div').append(source).ref('source')\n    )\n    return el;\n  }\n\n  // don't rerender because this would destroy ACE\n  shouldRerender(newProps, newState) {\n    return false;\n  }\n\n  didMount() {\n    let {language} = this.props\n    // let editorSession = this.context.editorSession\n    let node = this.props.node;\n    let editor = ace.edit(this.refs.source.getNativeElement())\n    // editor.setTheme(\"ace/theme/monokai\");\n    editor.setOptions({\n      maxLines: Infinity,\n    });\n    editor.$blockScrolling = Infinity;\n    editor.getSession().setMode(\"ace/mode/\" + language)\n    // TODO: don't we need to dispose the editor?\n    // For now we update the model only on blur\n    // Option 1: updating on blur\n    //   pro: one change for the whole code editing session\n    //   con: very implicit, very late, hard to get selection right\n    editor.on('blur', this._updateModelOnBlur.bind(this))\n    editor.on('change', this._updateModelOnBlur.bind(this))\n\n    editor.commands.addCommand({\n      name: 'escape',\n      bindKey: {win: 'Escape', mac: 'Escape'},\n      exec: function(editor) {\n        this.send('escape')\n        editor.blur()\n      }.bind(this),\n      readOnly: true // false if this command should not apply in readOnly mode\n    });\n\n    this.editor = editor\n    // editorSession.onRender('document', this._onModelChange, this, {\n    //   path: [node.id, 'source']\n    // })\n  }\n\n  dispose() {\n    // this.context.editorSession.off(this)\n    this.editor.destroy()\n  }\n\n  _updateModelOnBlur() {\n    let editor = this.editor\n    // let nodeId = this.props.node.id\n    let source = editor.getValue()\n    if (source !== this.props.source) {\n      // this.context.surface.transaction(function(tx) {\n      //   tx.set([nodeId, 'source'], editor.getValue())\n      // }, { source: this, skipSelection: true })\n      this.send('aceUpdated', source)\n    }\n  }\n\n  _onModelChange(change, info) {\n    if (info.source !== this) {\n      this.editor.setValue(this.props.source, -1)\n    }\n  }\n}\n\nAceEditor.fullWidth = true;\n","import {\n  Component, ProseEditor, ProseEditorConfigurator, EditorSession,\n  ProseEditorPackage, BlockNode, Tool, InsertNodeCommand\n} from 'substance'\n\nimport MathBlock from './MathBlock'\nimport MathJaxRenderComponent from './MathJaxRenderComponent'\nimport MathQuillComponent from './MathQuillComponent'\nimport AceComponent from './AceComponent'\n\nclass AdvancedMathEditWithPreview extends Component {\n  constructor(...args) {\n    super(...args)\n    this.handleActions({\n      'aceUpdated': this._aceUpdated,\n    })\n  }\n\n  getInitialState() {\n    return {source: this.props.source}\n  }\n\n  render($$) {\n    const {language} = this.props\n    const source = this.state.source || this.props.source\n\n    const el = $$('div')\n    .append('Enter Latex Source:')\n    .append(\n      // TODO: Use the ACE editor\n      // $$('input')\n      // .attr('value', source)\n      // .on('blur', this._updateSource)\n      // .on('keyup', this._updateSource)\n      // .ref('sourceLatex')\n      $$(AceComponent, {source, language}).ref('hack-to-not-rerender1')\n    )\n    .append($$(MathJaxRenderComponent, {source, language}).ref('hack-to-not-rerender2'))\n\n    return el\n  }\n\n  // _updateSource() {\n  //   const source = this.refs['sourceLatex'].getNativeElement().value\n  //   if (source !== this.state.source) {\n  //     this.extendState({source})\n  //     this.send('mathAdvancedUpdated', source)\n  //   }\n  // }\n\n  _aceUpdated(source) {\n    if (source !== this.state.source) {\n      this.extendState({source})\n      this.send('mathAdvancedUpdated', source)\n    }\n  }\n\n\n}\n\nclass MathEditModal extends Component {\n  constructor(...args) {\n    super(...args)\n\n    this.handleActions({\n      'mathQuillUpdated': this._sourceUpdated,\n      'mathAdvancedUpdated': this._sourceUpdated,\n    })\n  }\n\n  render($$) {\n    let {source, language} = this.props\n    let Button = this.getComponent('button')\n    let el = $$('div')\n    el.append($$('div'))\n    .append($$('h2').append('Edit the math below (uses MathQuill):'))\n    .append($$(MathQuillComponent, {source}))\n    .append($$('hr'))\n    .append($$('h2').append('Or, edit the latex directly'))\n    .append($$(AdvancedMathEditWithPreview, {language, source}))\n\n    el.append(\n      $$('div').addClass('se-actions').append(\n        $$(Button).addClass('se-save').append('Save').on('click', this._save),\n        $$(Button).addClass('se-cancel').append('Cancel').on('click', this._cancel)\n      )\n    )\n    return el\n  }\n\n  _sourceUpdated(source) {\n    this.__source__ = source\n  }\n  _save() {\n    this.send('saveMath', this.__source__)\n  }\n\n  _cancel() {\n    this.send('cancelMath')\n  }\n}\n\n/*\n  Display component\n*/\nclass MathEditComponent extends Component {\n  constructor(...args) {\n    super(...args)\n\n    this.handleActions({\n      'saveMath': this._saveAndCloseModal,\n      'cancelMath': this._closeModal,\n    })\n\n    this.props.node.on('properties:changed', this.rerender, this)\n  }\n\n  render($$) {\n    let Modal = this.getComponent('modal')\n    let node = this.props.node\n    let {language, source} = node\n\n    let el = $$('div').addClass('sc-math-editor')\n    el.append(\n      $$(MathJaxRenderComponent, {language, source}).ref('hack-to-not-rerender3')\n      .on('click', this._toggleEditor)\n    )\n\n    if (this.state.editMath) {\n      el.append(\n        $$(Modal, {\n          width: 'medium'\n        }).append(\n          // $$(EditorClass, contrib)\n          $$(MathEditModal, {language, source})\n        )\n      )\n    }\n\n    return el;\n  }\n\n  dispose() {\n    this.context.editorSession.off(this)\n  }\n\n  _saveAndCloseModal(source) {\n    let nodeId = this.props.node.id\n    if (source !== this.props.node.source) {\n      this.context.surface.transaction(function(tx) {\n        tx.set([nodeId, 'source'], source)\n      }, { source: this, skipSelection: true })\n    }\n    this._closeModal()\n  }\n\n  _closeModal() {\n    this.setState({\n      editMath: false\n    })\n  }\n\n  _toggleEditor() {\n    this.setState({\n      editMath: true\n    })\n  }\n\n  _updateModelOnBlur() {\n    let editor = this.editor\n    let nodeId = this.props.node.id\n    let source = editor.getValue()\n    if (source !== this.props.node.source) {\n      this.context.surface.transaction(function(tx) {\n        tx.set([nodeId, 'source'], editor.getValue())\n      }, { source: this, skipSelection: true })\n    }\n  }\n\n  _onModelChange(change, info) {\n    if (info.source !== this) {\n      this.editor.setValue(this.props.node.source, -1)\n    }\n  }\n}\n\nMathEditComponent.fullWidth = true;\n\n/*\n  Command for math insertion\n*/\nclass InsertMathCommand extends InsertNodeCommand {\n  createNodeData() {\n    return {\n      type: 'math',\n      language: 'text/tex',\n      content: ''\n    }\n  }\n}\n\n/*\n  Package defintion for math extension\n*/\nlet MathPackage = {\n  name: 'math',\n  configure: function(config) {\n    config.addNode(MathBlock)\n    config.addComponent(MathBlock.type, MathEditComponent)\n    config.addCommand('insert-math', InsertMathCommand)\n    config.addTool('insert-math', Tool, {toolGroup: 'insert'})\n    config.addIcon('insert-math', { 'fontawesome': 'fa-code' })\n    config.addLabel('insert-math', 'Math Formula')\n  }\n}\n\n/*\n  Example document\n*/\nlet fixture = function(tx) {\n  let body = tx.get('body')\n  tx.create({\n    id: 'h1',\n    type: 'heading',\n    level: 1,\n    content: 'MathEditor Test Page'\n  })\n  body.show('h1')\n  tx.create({\n    id: 'intro',\n    type: 'paragraph',\n    content: [\n      'These things should work: editing a formula using MathQuill (need to click twice to open the editor), editing using the \"Full-Source\", deleting a formula by pressing the Delete key, Undoing a delete by pressing Ctrl+Z, copying/cutting just the selected math element (and then pasting), copying/cutting multiple lines of text with math and pasting.',\n      // 'It is possible to use 3rd party components, a math editor for instance (which uses MathJax for rendering, MathQuill for WYSIWYG editing, and ACE for advanced text editing).',\n      // 'The editor us wrapped into a separate component which makes it independent from the main word-processor interface.',\n      // 'Here is some inline math that you should eventually be able to select and \"upgrade\" to real math: x=\\\\frac{-b\\\\pm \\\\sqrt{b^2-4ac}}{2a}',\n    ].join(\" \")\n  })\n  body.show('intro')\n  tx.create({\n    id: 's1',\n    type: 'math',\n    language: 'text/tex',\n    source: \"x=\\\\frac{-b\\\\pm \\\\sqrt{b^2-4ac}}{2a}\",\n  });\n  body.show('s1')\n  tx.create({\n    id: 'p2',\n    type: 'paragraph',\n    content: [\n      \"And here is another formula (which does not work in MathQuill)\"\n    ].join(\" \")\n  })\n  body.show('p2')\n\n  tx.create({\n    id: 's2',\n    type: 'math',\n    language: 'text/tex',\n    source:\n`\\\\mathbf{A} =\n\\\\begin{bmatrix}\na_{11} & a_{12} & \\\\cdots & a_{1n} \\\\\\\\\na_{21} & a_{22} & \\\\cdots & a_{2n} \\\\\\\\\n\\\\vdots & \\\\vdots & \\\\ddots & \\\\vdots \\\\\\\\\na_{m1} & a_{m2} & \\\\cdots & a_{mn}\n\\\\end{bmatrix} =\n\\\\left( \\\\begin{array}{rrrr}\na_{11} & a_{12} & \\\\cdots & a_{1n} \\\\\\\\\na_{21} & a_{22} & \\\\cdots & a_{2n} \\\\\\\\\n\\\\vdots & \\\\vdots & \\\\ddots & \\\\vdots \\\\\\\\\na_{m1} & a_{m2} & \\\\cdots & a_{mn}\n\\\\end{array} \\\\right) =\\\\left(a_{ij}\\\\right) \\\\in \\\\mathbb{R}^{m \\\\times n}.\n`,\n  });\n  body.show('s2')\n\n  tx.create({\n    id: 'the-end',\n    type: 'paragraph',\n    content: [\n      \"TODO: Support delete key when selected, Make modal pretty, Support MathML, Add/edit/upgrade-by-selecting inline math, Formula cheat-sheet. That's it!\"\n    ].join(\" \")\n  })\n  body.show('the-end')\n}\n\n/*\n  Application\n*/\nlet cfg = new ProseEditorConfigurator()\ncfg.import(ProseEditorPackage)\ncfg.import(MathPackage)\n\nwindow.onload = function() {\n  let doc = cfg.createArticle(fixture)\n  let editorSession = new EditorSession(doc, {\n    configurator: cfg\n  })\n  ProseEditor.mount({\n    editorSession: editorSession\n  }, document.body)\n}\n"],"names":["BlockNode","Component","AceComponent","InsertNodeCommand","Tool","ProseEditorConfigurator","ProseEditorPackage","EditorSession","ProseEditor"],"mappings":"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"}