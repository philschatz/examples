{"version":3,"file":null,"sources":["../../math-editor/MathBlock.js","../../math-editor/MathJaxRenderComponent.js","../../math-editor/MathQuillComponent.js","../../math-editor/AceComponent.js","../../math-editor/fixture.js","../../body/Body.js","../../body/BodyConverter.js","../../body/BodyComponent.js","../../body/BodyPackage.js","../../math-editor/SimpleHTMLImporter.js","../../math-editor/SimpleWriterPackage.js","../../math-editor/MathConverter.js","../../math-editor/app.js"],"sourcesContent":["import { BlockNode } from 'substance'\n\n/*\n  Node definition\n*/\nclass MathBlock extends BlockNode {}\n\nMathBlock.define({\n  type: 'math',\n  language: 'text/tex',\n  source: 'text'\n})\n\n\nexport default MathBlock\n","import {Component} from 'substance'\n\nif (!window.MathJax) {\n  throw new Error('BUG: MathJax has not been loaded yet')\n}\n\nexport default class MathJaxRenderComponent extends Component {\n  render($$) {\n    let {node, language, source} = this.props\n\n    let el = $$('div').addClass('sc-math-render')\n    .append('Rendering ' + source)\n    .ref('renderedMathNode')\n    return el\n  }\n\n  // don't rerender because this would destroy MathJax\n  shouldRerender(newProps, newState) {\n    return this._isRenderNeeded(this.props, newProps)\n  }\n\n  _isRenderNeeded(oldProps, newProps) {\n    const {language, source} = oldProps\n    return language !== newProps.language || source.trim() !== newProps.source.trim()\n  }\n\n  didUpdate(oldProps, oldState) {\n    if (this._isRenderNeeded(oldProps, this.props)) {\n      this._renderMathJax()\n    }\n  }\n  didMount() {\n    this._renderMathJax()\n    // let editor = ace.edit(this.refs.source.getNativeElement())\n    // // editor.setTheme(\"ace/theme/monokai\");\n    // editor.setOptions({\n    //   maxLines: Infinity,\n    // });\n    // editor.$blockScrolling = Infinity;\n    // editor.getSession().setMode(\"ace/mode/\" + node.language)\n    // // TODO: don't we need to dispose the editor?\n    // // For now we update the model only on blur\n    // // Option 1: updating on blur\n    // //   pro: one change for the whole code editing session\n    // //   con: very implicit, very late, hard to get selection right\n    // editor.on('blur', this._updateModelOnBlur.bind(this))\n    //\n    // editor.commands.addCommand({\n    //   name: 'escape',\n    //   bindKey: {win: 'Escape', mac: 'Escape'},\n    //   exec: function(editor) {\n    //     this.send('escape')\n    //     editor.blur()\n    //   }.bind(this),\n    //   readOnly: true // false if this command should not apply in readOnly mode\n    // });\n    //\n    // this.editor = editor\n    // editorSession.onRender('document', this._onModelChange, this, {\n    //   path: [node.id, 'source']\n    // })\n  }\n\n  _renderMathJax() {\n    let {node, language, source} = this.props\n    let nativeMathContainer = this.refs['renderedMathNode'].getNativeElement()\n\n    // HACK? so shouldRender is called\n    // this.el = this.refs['renderedMathNode']\n\n    // Mark node up so MathJax understands\n    if (language === 'text/tex') {\n      nativeMathContainer.innerHTML = '$$' + source + '$$'\n    } else {\n      throw new Error('BUG: No math language set!')\n    }\n\n    function cb() {\n      console.log('MathJaxDoneRendering')\n    }\n    MathJax.Hub.Queue([\"Typeset\", MathJax.Hub, nativeMathContainer, cb])\n  }\n}\n","import {Component} from 'substance'\n\nif (!window.MathQuill) {\n  throw new Error('BUG: MathQuill has not been loaded yet')\n}\n\nexport default class MathQuillComponent extends Component {\n  render($$) {\n    let {node, language, source} = this.props\n\n    let el = $$('span').addClass('sc-mathquill-input').append(source)\n    .ref('mathQuillInput')\n    return el\n  }\n\n  // don't rerender because this would destroy MathJax\n  shouldRerender() {\n    return false;\n  }\n\n  _updateLatex() {\n    this.send('mathQuillUpdated', this._mathField.latex())\n  }\n\n  didMount() {\n    let {node, language, source} = this.props\n    let mathQuillInput = this.refs['mathQuillInput'].getNativeElement()\n\n    let MQ = MathQuill.getInterface(2) // for backcompat\n    this._mathField = MQ.MathField(mathQuillInput, {\n      spaceBehavesLikeTab: true, // configurable\n      handlers: {\n        edit: this._updateLatex.bind(this)\n      }\n    })\n  }\n\n}\n","import {Component} from 'substance'\n\nexport default class AceEditor extends Component {\n  render($$) {\n    let {source} = this.props\n    let el = $$('div').addClass('sc-ace-editor')\n    el.append(\n      $$('div').append(source).ref('source')\n    )\n    return el;\n  }\n\n  // don't rerender because this would destroy ACE\n  shouldRerender(newProps, newState) {\n    return false;\n  }\n\n  didMount() {\n    let {language} = this.props\n    // let editorSession = this.context.editorSession\n    let node = this.props.node;\n    let editor = ace.edit(this.refs.source.getNativeElement())\n    // editor.setTheme(\"ace/theme/monokai\");\n    editor.setOptions({\n      maxLines: Infinity,\n    });\n    editor.$blockScrolling = Infinity;\n    editor.getSession().setMode(\"ace/mode/\" + language)\n    // TODO: don't we need to dispose the editor?\n    // For now we update the model only on blur\n    // Option 1: updating on blur\n    //   pro: one change for the whole code editing session\n    //   con: very implicit, very late, hard to get selection right\n    editor.on('blur', this._updateModelOnBlur.bind(this))\n    editor.on('change', this._updateModelOnBlur.bind(this))\n\n    editor.commands.addCommand({\n      name: 'escape',\n      bindKey: {win: 'Escape', mac: 'Escape'},\n      exec: function(editor) {\n        this.send('escape')\n        editor.blur()\n      }.bind(this),\n      readOnly: true // false if this command should not apply in readOnly mode\n    });\n\n    this.editor = editor\n    // editorSession.onRender('document', this._onModelChange, this, {\n    //   path: [node.id, 'source']\n    // })\n  }\n\n  dispose() {\n    // this.context.editorSession.off(this)\n    this.editor.destroy()\n  }\n\n  _updateModelOnBlur() {\n    let editor = this.editor\n    // let nodeId = this.props.node.id\n    let source = editor.getValue()\n    if (source !== this.props.source) {\n      // this.context.surface.transaction(function(tx) {\n      //   tx.set([nodeId, 'source'], editor.getValue())\n      // }, { source: this, skipSelection: true })\n      this.send('aceUpdated', source)\n    }\n  }\n\n  _onModelChange(change, info) {\n    if (info.source !== this) {\n      this.editor.setValue(this.props.source, -1)\n    }\n  }\n}\n\nAceEditor.fullWidth = true;\n","export default `\n<html>\n  <body>\n    <h1>MathEditor Test Page!!!</h1>\n    <p>\n      These things should work:\n    </p>\n    <ul>\n      <li>editing a formula using MathQuill (need to click twice to open the editor)</li>\n      <li>editing using the \"Full-Source\"</li>\n      <li>deleting a formula by pressing the Delete key</li>\n      <li>Undoing a delete by pressing Ctrl+Z</li>\n      <li>copying/cutting just the selected math element (and then pasting)</li>\n      <li>copying/cutting multiple lines of text with math and pasting</li>\n    </ul>\n    <div data-math=\"x=\\\\frac{-b\\\\pm \\\\sqrt{b^2-4ac}}{2a}\"></div>\n    <p>And here is another formula (which does not work in MathQuill)</p>\n    <div data-math>\n\\\\mathbf{A} =\n\\\\begin{bmatrix}\na_{11} & a_{12} & \\\\cdots & a_{1n} \\\\\\\\\na_{21} & a_{22} & \\\\cdots & a_{2n} \\\\\\\\\n\\\\vdots & \\\\vdots & \\\\ddots & \\\\vdots \\\\\\\\\na_{m1} & a_{m2} & \\\\cdots & a_{mn}\n\\\\end{bmatrix} =\n\\\\left( \\\\begin{array}{rrrr}\na_{11} & a_{12} & \\\\cdots & a_{1n} \\\\\\\\\na_{21} & a_{22} & \\\\cdots & a_{2n} \\\\\\\\\n\\\\vdots & \\\\vdots & \\\\ddots & \\\\vdots \\\\\\\\\na_{m1} & a_{m2} & \\\\cdots & a_{mn}\n\\\\end{array} \\\\right) =\\\\left(a_{ij}\\\\right) \\\\in \\\\mathbb{R}^{m \\\\times n}.\n    </div>\n    <h1>TODO</h1>\n    <ol>\n      <li>Support delete key when selected</li>\n      <li>Make modal pretty</li>\n      <li>Support MathML</li>\n      <li>Add/edit/upgrade-by-selecting inline math</li>\n      <li>Formula cheat-sheet</li>\n    </ol>\n  </body>\n</html>\n`\n","import {Container} from 'substance'\n\nclass Body extends Container {}\n\nBody.define({\n  type: 'body'\n})\n\nexport default Body","export default {\n  type: 'body',\n  tagName: 'body',\n\n  import: function(el, node, converter) {\n    node.id = 'body'\n    node.nodes = el.children.map(function(child) {\n      var childNode = converter.convertElement(child)\n      return childNode.id\n    })\n  },\n\n  export: function(node, el, converter) {\n    el.append(converter.convertNodes(node.nodes))\n  }\n}","import { Component, ContainerEditor } from 'substance'\n\nclass BodyComponent extends Component {\n  render($$) {\n    let node = this.props.node;\n    let el = $$('div')\n      .addClass('sc-body')\n      .attr('data-id', this.props.node.id);\n\n    el.append(\n      $$(ContainerEditor, {\n        disabled: this.props.disabled,\n        node: node,\n        commands: this.props.commands,\n        textTypes: this.props.textTypes\n      }).ref('body')\n    );\n    return el;\n  }\n}\n\nexport default BodyComponent","import Body from './Body'\nimport BodyConverter from './BodyConverter'\nimport BodyComponent from './BodyComponent'\n\nexport default {\n  name: 'body',\n  configure: function(config) {\n    config.addNode(Body)\n    config.addComponent(Body.type, BodyComponent)\n    config.addConverter('html', BodyConverter)\n  }\n}","import { HTMLImporter } from 'substance'\n\n/**\n  HTML importer for the SimpleArticle. We delegate the work to\n  BodyConverter.\n*/\nexport default class SimpleHTMLImporter extends HTMLImporter {\n  convertDocument(htmlEl) {\n    var bodyEl = htmlEl.find('body')\n    this.convertElement(bodyEl)\n  }\n}","import {\n  BasePackage, StrongPackage, EmphasisPackage, LinkPackage, ListPackage, Document,\n  ParagraphPackage, HeadingPackage\n} from 'substance'\n\nimport BodyPackage from '../body/BodyPackage'\nimport SimpleHTMLImporter from './SimpleHTMLImporter'\n\n/**\n  Standard configuration for SimpleWriter\n\n  We define a schema (simple-article) import some core packages\n  from Substance, as well as custom node types.\n\n  An HTML importer is registered to be able to turn HTML markup\n  into a SimpleArticle instance.\n*/\nexport default {\n  name: 'simple-writer',\n  configure: function (config) {\n    config.defineSchema({\n      name: 'simple-article',\n      ArticleClass: Document,\n      defaultTextType: 'paragraph'\n    })\n\n    // Commented because these are already defined in ProseEditorPackage\n\n    // BasePackage provides core functionaliy, such as undo/redo\n    // and the SwitchTextTypeTool. However, you could import those\n    // functionalities individually if you need more control\n    // config.import(BasePackage)\n\n    // core nodes\n    // config.import(ParagraphPackage)\n    // config.import(HeadingPackage)\n    // config.import(StrongPackage, {toolTarget: 'annotations'})\n    // config.import(EmphasisPackage, {toolTarget: 'annotations'})\n    // config.import(LinkPackage, {toolTarget: 'annotations'})\n\n    config.import(ListPackage)\n\n    // custom nodes\n    config.import(BodyPackage)\n    // config.import(MathPackage, {toolTarget: 'annotations'})\n\n    // Override Importer/Exporter\n    config.addImporter('html', SimpleHTMLImporter)\n  }\n}\n","export default {\n\n  type: 'math',\n  tagName: 'span',\n\n  /**\n    Custom matcher, needed as matching by tagName is not sufficient\n  */\n  matchElement: function(el) {\n    return el.is('div[data-math]')\n  },\n\n  /**\n    Extract math string from the data-math attribute\n  */\n  import: function(el, node) {\n    // node.content = el.attr('data-math') || el.textContent\n    node.source = el.attr('data-math') || el.textContent\n    node.language = el.attr('data-lang') || 'text/tex'\n  },\n\n  /**\n    Serialize math node to span with data-type and data-math\n    attributes.\n  */\n  export: function(node, el) {\n    el.attr({\n      'data-type': 'math',\n      'data-math': node.source,\n      'data-lang': node.language,\n    }).append(node.source)\n  }\n}\n","import {\n  Component, ProseEditor, Configurator, ProseEditorConfigurator, EditorSession, DocumentSession,\n  ProseEditorPackage, BlockNode, Tool, InsertNodeCommand\n} from 'substance'\n\nimport MathBlock from './MathBlock'\nimport MathJaxRenderComponent from './MathJaxRenderComponent'\nimport MathQuillComponent from './MathQuillComponent'\nimport AceComponent from './AceComponent'\nimport fixture from './fixture'\nimport SimpleWriterPackage from './SimpleWriterPackage'\nimport MathConverter from './MathConverter'\n\nclass AdvancedMathEditWithPreview extends Component {\n  constructor(...args) {\n    super(...args)\n    this.handleActions({\n      'aceUpdated': this._aceUpdated,\n    })\n  }\n\n  getInitialState() {\n    return {source: this.props.source}\n  }\n\n  render($$) {\n    const {language} = this.props\n    const source = this.state.source || this.props.source\n\n    const el = $$('div')\n    .append('Enter Latex Source:')\n    .append(\n      // TODO: Use the ACE editor\n      // $$('input')\n      // .attr('value', source)\n      // .on('blur', this._updateSource)\n      // .on('keyup', this._updateSource)\n      // .ref('sourceLatex')\n      $$(AceComponent, {source, language}).ref('hack-to-not-rerender1')\n    )\n    .append($$(MathJaxRenderComponent, {source, language}).ref('hack-to-not-rerender2'))\n\n    return el\n  }\n\n  // _updateSource() {\n  //   const source = this.refs['sourceLatex'].getNativeElement().value\n  //   if (source !== this.state.source) {\n  //     this.extendState({source})\n  //     this.send('mathAdvancedUpdated', source)\n  //   }\n  // }\n\n  _aceUpdated(source) {\n    if (source !== this.state.source) {\n      this.extendState({source})\n      this.send('mathAdvancedUpdated', source)\n    }\n  }\n\n\n}\n\nclass MathEditModal extends Component {\n  constructor(...args) {\n    super(...args)\n\n    this.handleActions({\n      'mathQuillUpdated': this._sourceUpdated,\n      'mathAdvancedUpdated': this._sourceUpdated,\n    })\n  }\n\n  render($$) {\n    let {source, language} = this.props\n    let Button = this.getComponent('button')\n    let el = $$('div')\n    el.append($$('div'))\n    .append($$('h2').append('Edit the math below (uses MathQuill):'))\n    .append($$(MathQuillComponent, {source}))\n    .append($$('hr'))\n    .append($$('h2').append('Or, edit the latex directly'))\n    .append($$(AdvancedMathEditWithPreview, {language, source}))\n\n    el.append(\n      $$('div').addClass('se-actions').append(\n        $$(Button).addClass('se-save').append('Save').on('click', this._save),\n        $$(Button).addClass('se-cancel').append('Cancel').on('click', this._cancel)\n      )\n    )\n    return el\n  }\n\n  _sourceUpdated(source) {\n    this.__source__ = source\n  }\n  _save() {\n    this.send('saveMath', this.__source__)\n  }\n\n  _cancel() {\n    this.send('cancelMath')\n  }\n}\n\n/*\n  Display component\n*/\nclass MathEditComponent extends Component {\n  constructor(...args) {\n    super(...args)\n\n    this.handleActions({\n      'saveMath': this._saveAndCloseModal,\n      'cancelMath': this._closeModal,\n    })\n\n    this.props.node.on('properties:changed', this.rerender, this)\n  }\n\n  render($$) {\n    let Modal = this.getComponent('modal')\n    let node = this.props.node\n    let {language, source} = node\n\n    let el = $$('div').addClass('sc-math-editor')\n    el.append(\n      $$(MathJaxRenderComponent, {language, source}).ref('hack-to-not-rerender3')\n      .on('click', this._toggleEditor)\n    )\n\n    if (this.state.editMath) {\n      el.append(\n        $$(Modal, {\n          width: 'medium'\n        }).append(\n          // $$(EditorClass, contrib)\n          $$(MathEditModal, {language, source})\n        )\n      )\n    }\n\n    return el;\n  }\n\n  dispose() {\n    this.context.editorSession.off(this)\n  }\n\n  _saveAndCloseModal(source) {\n    let nodeId = this.props.node.id\n    if (source !== this.props.node.source) {\n      this.context.surface.transaction(function(tx) {\n        tx.set([nodeId, 'source'], source)\n      }, { source: this, skipSelection: true })\n    }\n    this._closeModal()\n  }\n\n  _closeModal() {\n    this.setState({\n      editMath: false\n    })\n  }\n\n  _toggleEditor() {\n    this.setState({\n      editMath: true\n    })\n  }\n\n  _updateModelOnBlur() {\n    let editor = this.editor\n    let nodeId = this.props.node.id\n    let source = editor.getValue()\n    if (source !== this.props.node.source) {\n      this.context.surface.transaction(function(tx) {\n        tx.set([nodeId, 'source'], editor.getValue())\n      }, { source: this, skipSelection: true })\n    }\n  }\n\n  _onModelChange(change, info) {\n    if (info.source !== this) {\n      this.editor.setValue(this.props.node.source, -1)\n    }\n  }\n}\n\nMathEditComponent.fullWidth = true;\n\n/*\n  Command for math insertion\n*/\nclass InsertMathCommand extends InsertNodeCommand {\n  createNodeData() {\n    return {\n      type: 'math',\n      language: 'text/tex',\n      content: ''\n    }\n  }\n}\n\n/*\n  Package defintion for math extension\n*/\nlet MathPackage = {\n  name: 'math',\n  configure: function(config) {\n    config.addNode(MathBlock)\n    config.addConverter('html', MathConverter)\n    config.addComponent(MathBlock.type, MathEditComponent)\n    config.addCommand('insert-math', InsertMathCommand)\n    config.addTool('insert-math', Tool, {toolGroup: 'insert'})\n    config.addIcon('insert-math', { 'fontawesome': 'fa-code' })\n    config.addLabel('insert-math', 'Math Formula')\n  }\n}\n\n/*\n  Application\n*/\n// let cfg = new ProseEditorConfigurator()\nlet cfg = new Configurator()\ncfg.import(ProseEditorPackage)\ncfg.import(SimpleWriterPackage)\ncfg.import(MathPackage)\n\nwindow.onload = function() {\n  // let doc = cfg.createArticle(fixture)\n  // let editorSession = new EditorSession(doc, {\n  //   configurator: cfg\n  // })\n  // ProseEditor.mount({\n  //   editorSession: editorSession\n  // }, document.body)\n  // Import article from HTML markup\n  let importer = cfg.createImporter('html')\n  let doc = importer.importDocument(fixture)\n  // This is the data structure manipulated by the editor\n  // let documentSession = new DocumentSession(doc)\n  let editorSession = new EditorSession(doc, {\n    configurator: cfg\n  })\n  // Mount SimpleWriter to the DOM and run it.\n  ProseEditor.mount({\n    editorSession: editorSession,\n    // documentSession: documentSession,\n    configurator: cfg\n  }, document.body)\n}\n"],"names":["BlockNode","Component","Container","ContainerEditor","HTMLImporter","Document","ListPackage","AceComponent","InsertNodeCommand","Tool","Configurator","ProseEditorPackage","EditorSession","ProseEditor"],"mappings":"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"}