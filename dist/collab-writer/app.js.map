{"version":3,"file":null,"sources":["../../collab-writer/app.js"],"sourcesContent":["import {\n  Component, SplitPane, twoParagraphs, MessageQueue, TestWebSocketServer,\n  TestWebSocketConnection, TestCollabServer, DocumentEngine, DocumentStore,\n  ChangeStore, documentStoreSeed, changeStoreSeed, createTestDocumentFactory,\n  ProseEditorConfigurator, ProseEditorPackage, Surface, CollabClient,\n  TestCollabSession, ProseEditor\n} from 'substance'\n\nconst collabWriterConfig = {\n  name: 'collab-writer',\n  configure: function(config) {\n    config.import(ProseEditorPackage)\n    // TODO: Add custom tools\n    // config.addTool...\n  }\n}\n\nvar configurator = new ProseEditorConfigurator().import(collabWriterConfig)\n\nclass Client extends Component {\n  constructor(...args) {\n    super(...args)\n\n    this.doc = configurator.createArticle(twoParagraphs)\n\n    if (!this.props.connection) {\n      throw new Error(\"'connection' is required.\");\n    }\n\n    this.collabClient = new CollabClient({\n      connection: this.props.connection\n    });\n\n    // CollabSession expects a connected and authenticated collabClient\n    this.session = new TestCollabSession(this.doc, {\n      configurator: configurator,\n      collabClient: this.collabClient,\n      documentId: 'test-doc',\n      version: 0,\n      logging: true,\n      autoSync: true\n    });\n  }\n\n  didMount() {\n    this.refs.editor.refs.body.selectFirst();\n  }\n\n  render($$) {\n    var el = $$('div').addClass('sc-client').addClass('sm-'+this.props.userId);\n    var editor = $$(ProseEditor, {\n      disabled: this.props.disabled,\n      editorSession: this.session\n    }).ref('editor');\n    if (this.props.disabled) {\n      el.append(\n        $$('div').addClass('se-blocker')\n          .on('mousedown', this.onMousedown)\n      );\n    }\n    el.append(editor)\n    return el\n  }\n\n  onMousedown(e) {\n    e.stopPropagation()\n    e.preventDefault()\n    this.send('switchUser', this.props.userId)\n  }\n}\n\n/*\n  App\n*/\nclass App extends Component {\n\n  constructor(...args) {\n    super(...args)\n\n    this.documentStore = new DocumentStore().seed(documentStoreSeed)\n    this.changeStore = new ChangeStore().seed(changeStoreSeed)\n    this.documentEngine = new DocumentEngine({\n      documentStore: this.documentStore,\n      changeStore: this.changeStore,\n      schemas: {\n        'prose-article': {\n          name: 'prose-article',\n          version: '1.0.0',\n          documentFactory: createTestDocumentFactory(twoParagraphs)\n        }\n      }\n    })\n    this.messageQueue = new MessageQueue()\n    this.wss = new TestWebSocketServer({\n      messageQueue: this.messageQueue,\n      serverId: 'hub'\n    })\n    this.collabServer = new TestCollabServer({\n      documentEngine: this.documentEngine\n    })\n    this.collabServer.bind(this.wss);\n\n    this.conn1 = new TestWebSocketConnection({\n      messageQueue: this.messageQueue,\n      clientId: 'user1',\n      serverId: 'hub',\n    })\n    this.conn2 = new TestWebSocketConnection({\n      messageQueue: this.messageQueue,\n      clientId: 'user2',\n      serverId: 'hub'\n    })\n\n    this.messageQueue.flush()\n    this.messageQueue.start()\n    this.handleAction('switchUser', this.switchUser)\n  }\n\n  render($$) {\n    var el = $$('div').addClass('sc-two-editors')\n    el.append(\n      $$(SplitPane, {\n        splitType: 'vertical',\n        sizeA: '50%'\n      }).append(\n        $$(Client, {\n          userId: 'user1',\n          connection: this.conn1\n        }).ref('user1'),\n        $$(Client, {\n          userId: 'user2',\n          connection: this.conn2,\n          disabled: true\n        }).ref('user2')\n      )\n    )\n    return el;\n  }\n\n  // enables the editor for user1 and disables the other\n  // Note: being in one DOM it doesn't work to have two\n  // active editors at the same time\n  switchUser(userId) {\n    if (userId === 'user1') {\n      this.refs.user1.extendProps({ disabled: false })\n      this.refs.user2.extendProps({ disabled: true })\n    } else if (userId === 'user2') {\n      this.refs.user1.extendProps({ disabled: true })\n      this.refs.user2.extendProps({ disabled: false })\n    }\n  }\n}\n\nwindow.onload = function() {\n  App.mount({}, document.body)\n}\n"],"names":["ProseEditorPackage","ProseEditorConfigurator","Component","twoParagraphs","CollabClient","TestCollabSession","ProseEditor","DocumentStore","documentStoreSeed","ChangeStore","changeStoreSeed","DocumentEngine","createTestDocumentFactory","MessageQueue","TestWebSocketServer","TestCollabServer","TestWebSocketConnection","SplitPane"],"mappings":";;;;;;AAQA,MAAM,kBAAkB,GAAG;EACzB,IAAI,EAAE,eAAe;EACrB,SAAS,EAAE,SAAS,MAAM,EAAE;IAC1B,MAAM,CAAC,MAAM,CAACA,4BAAkB,CAAC;;;GAGlC;CACF;;AAED,IAAI,YAAY,GAAG,IAAIC,iCAAuB,EAAE,CAAC,MAAM,CAAC,kBAAkB,CAAC;;AAE3E,MAAM,MAAM,SAASC,mBAAS,CAAC;EAC7B,WAAW,CAAC,GAAG,IAAI,EAAE;IACnB,KAAK,CAAC,GAAG,IAAI,CAAC;;IAEd,IAAI,CAAC,GAAG,GAAG,YAAY,CAAC,aAAa,CAACC,uBAAa,CAAC;;IAEpD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE;MAC1B,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;KAC9C;;IAED,IAAI,CAAC,YAAY,GAAG,IAAIC,sBAAY,CAAC;MACnC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU;KAClC,CAAC,CAAC;;;IAGH,IAAI,CAAC,OAAO,GAAG,IAAIC,2BAAiB,CAAC,IAAI,CAAC,GAAG,EAAE;MAC7C,YAAY,EAAE,YAAY;MAC1B,YAAY,EAAE,IAAI,CAAC,YAAY;MAC/B,UAAU,EAAE,UAAU;MACtB,OAAO,EAAE,CAAC;MACV,OAAO,EAAE,IAAI;MACb,QAAQ,EAAE,IAAI;KACf,CAAC,CAAC;GACJ;;EAED,QAAQ,GAAG;IACT,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;GAC1C;;EAED,MAAM,CAAC,EAAE,EAAE;IACT,IAAI,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;IAC3E,IAAI,MAAM,GAAG,EAAE,CAACC,qBAAW,EAAE;MAC3B,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ;MAC7B,aAAa,EAAE,IAAI,CAAC,OAAO;KAC5B,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IACjB,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;MACvB,EAAE,CAAC,MAAM;QACP,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,YAAY,CAAC;WAC7B,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC;OACrC,CAAC;KACH;IACD,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC;IACjB,OAAO,EAAE;GACV;;EAED,WAAW,CAAC,CAAC,EAAE;IACb,CAAC,CAAC,eAAe,EAAE;IACnB,CAAC,CAAC,cAAc,EAAE;IAClB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;GAC3C;CACF;;;;;AAKD,MAAM,GAAG,SAASJ,mBAAS,CAAC;;EAE1B,WAAW,CAAC,GAAG,IAAI,EAAE;IACnB,KAAK,CAAC,GAAG,IAAI,CAAC;;IAEd,IAAI,CAAC,aAAa,GAAG,IAAIK,uBAAa,EAAE,CAAC,IAAI,CAACC,2BAAiB,CAAC;IAChE,IAAI,CAAC,WAAW,GAAG,IAAIC,qBAAW,EAAE,CAAC,IAAI,CAACC,yBAAe,CAAC;IAC1D,IAAI,CAAC,cAAc,GAAG,IAAIC,wBAAc,CAAC;MACvC,aAAa,EAAE,IAAI,CAAC,aAAa;MACjC,WAAW,EAAE,IAAI,CAAC,WAAW;MAC7B,OAAO,EAAE;QACP,eAAe,EAAE;UACf,IAAI,EAAE,eAAe;UACrB,OAAO,EAAE,OAAO;UAChB,eAAe,EAAEC,mCAAyB,CAACT,uBAAa,CAAC;SAC1D;OACF;KACF,CAAC;IACF,IAAI,CAAC,YAAY,GAAG,IAAIU,sBAAY,EAAE;IACtC,IAAI,CAAC,GAAG,GAAG,IAAIC,6BAAmB,CAAC;MACjC,YAAY,EAAE,IAAI,CAAC,YAAY;MAC/B,QAAQ,EAAE,KAAK;KAChB,CAAC;IACF,IAAI,CAAC,YAAY,GAAG,IAAIC,0BAAgB,CAAC;MACvC,cAAc,EAAE,IAAI,CAAC,cAAc;KACpC,CAAC;IACF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;IAEjC,IAAI,CAAC,KAAK,GAAG,IAAIC,iCAAuB,CAAC;MACvC,YAAY,EAAE,IAAI,CAAC,YAAY;MAC/B,QAAQ,EAAE,OAAO;MACjB,QAAQ,EAAE,KAAK;KAChB,CAAC;IACF,IAAI,CAAC,KAAK,GAAG,IAAIA,iCAAuB,CAAC;MACvC,YAAY,EAAE,IAAI,CAAC,YAAY;MAC/B,QAAQ,EAAE,OAAO;MACjB,QAAQ,EAAE,KAAK;KAChB,CAAC;;IAEF,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE;IACzB,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE;IACzB,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC;GACjD;;EAED,MAAM,CAAC,EAAE,EAAE;IACT,IAAI,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC;IAC7C,EAAE,CAAC,MAAM;MACP,EAAE,CAACC,mBAAS,EAAE;QACZ,SAAS,EAAE,UAAU;QACrB,KAAK,EAAE,KAAK;OACb,CAAC,CAAC,MAAM;QACP,EAAE,CAAC,MAAM,EAAE;UACT,MAAM,EAAE,OAAO;UACf,UAAU,EAAE,IAAI,CAAC,KAAK;SACvB,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC;QACf,EAAE,CAAC,MAAM,EAAE;UACT,MAAM,EAAE,OAAO;UACf,UAAU,EAAE,IAAI,CAAC,KAAK;UACtB,QAAQ,EAAE,IAAI;SACf,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC;OAChB;KACF;IACD,OAAO,EAAE,CAAC;GACX;;;;;EAKD,UAAU,CAAC,MAAM,EAAE;IACjB,IAAI,MAAM,KAAK,OAAO,EAAE;MACtB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;MAChD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;KAChD,MAAM,IAAI,MAAM,KAAK,OAAO,EAAE;MAC7B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;MAC/C,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;KACjD;GACF;CACF;;AAED,MAAM,CAAC,MAAM,GAAG,WAAW;EACzB,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,QAAQ,CAAC,IAAI,CAAC;CAC7B;;"}